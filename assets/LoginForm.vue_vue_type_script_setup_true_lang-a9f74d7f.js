import{F as e}from"./Form-be9580cb.js";import{d as o,b as a,m as t,u as s,q as r,e as l,F as n,I as i,r as d,V as c,o as u,i as m,a as p,M as f,a3 as g,k as h}from"./index-10360f2b.js";import{E as w}from"./el-button-481782c7.js";import{b as v}from"./tsxHelper-459740a4.js";import{E as b}from"./el-link-cd2cbde0.js";import{u as R}from"./useForm-6ab72f3c.js";import{l as y,g as P,a as j}from"./index-018c2406.js";import{u as I}from"./useValidator-3f79ae4e.js";function x(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!f(e)}const k="#999",E="var(--el-color-primary)",F=o({__name:"LoginForm",emits:["to-register"],setup(o,{emit:f}){const{required:F}=I(),z=a(),A=t(),{currentRoute:C,addRoute:q,push:V}=s(),{setStorage:D}=g(),{t:_}=h(),L={username:[F()],password:[F()]},M=r([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>l("h2",{class:"text-2xl font-bold text-center w-[100%]"},[_("login.login")])}}},{field:"username",label:_("login.username"),value:"admin",component:"Input",colProps:{span:24},componentProps:{placeholder:_("login.usernamePlaceholder")}},{field:"password",label:_("login.password"),value:"admin",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:_("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return l(n,null,[l("div",{class:"flex justify-between items-center w-[100%]"},[l(v,{modelValue:O.value,"onUpdate:modelValue":e=>O.value=e,label:_("login.remember"),size:"small"},null),l(b,{type:"primary",underline:!1},x(e=_("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return l(n,null,[l("div",{class:"w-[100%]"},[l(w,{loading:$.value,type:"primary",class:"w-[100%]",onClick:G},x(e=_("login.login"))?e:{default:()=>[e]})]),l("div",{class:"w-[100%] mt-15px"},[l(w,{class:"w-[100%]",onClick:K},x(o=_("login.register"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:_("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>l(n,null,[l("div",{class:"flex justify-between w-[100%]"},[l(i,{icon:"ant-design:github-filled",size:30,class:"cursor-pointer ant-icon",color:k,hoverColor:E},null),l(i,{icon:"ant-design:wechat-filled",size:30,class:"cursor-pointer ant-icon",color:k,hoverColor:E},null),l(i,{icon:"ant-design:alipay-circle-filled",size:30,color:k,hoverColor:E,class:"cursor-pointer ant-icon"},null),l(i,{icon:"ant-design:weibo-circle-filled",size:30,color:k,hoverColor:E,class:"cursor-pointer ant-icon"},null)])])}}}]),O=d(!1),{formRegister:S,formMethods:U}=R(),{getFormData:H,getElFormExpose:N}=U,$=d(!1),B=d("");c((()=>C.value),(e=>{var o;B.value=null==(o=null==e?void 0:e.query)?void 0:o.redirect}),{immediate:!0});const G=async()=>{await A.generateRoutes("none").catch((()=>{})),A.getAddRouters.forEach((e=>{q(e)})),A.setIsAddRouters(!0),V({path:B.value||A.addRouters[0].path});const e=await N();await(null==e?void 0:e.validate((async e=>{if(e){$.value=!0;const e=await H();try{const o=await y(e);o&&(D(z.getUserInfo,o.data),z.getDynamicRouter?J():(await A.generateRoutes("none").catch((()=>{})),A.getAddRouters.forEach((e=>{q(e)})),A.setIsAddRouters(!0),V({path:B.value||A.addRouters[0].path})))}finally{$.value=!1}}})))},J=async()=>{const e=await H(),o={roleName:e.username},a="admin"===e.username?await P(o):await j(o);if(a){const o=a.data||[];D("roleRouters",o),"admin"===e.username?await A.generateRoutes("admin",o).catch((()=>{})):await A.generateRoutes("test",o).catch((()=>{})),A.getAddRouters.forEach((e=>{q(e)})),A.setIsAddRouters(!0),V({path:B.value||A.addRouters[0].path})}},K=()=>{f("to-register")};return(o,a)=>(u(),m(p(e),{schema:M,rules:L,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:p(S)},null,8,["schema","onRegister"]))}});export{F as _};
