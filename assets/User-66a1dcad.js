import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-fa85e763.js";import{d as a,a as t,q as l,e as o,F as r,r as s,V as i,o as n,c as d,w as u,f as m,t as p,B as c,N as f,i as v,R as _,M as h,k as y,O as g}from"./index-69408057.js";import{_ as j}from"./Table.vue_vue_type_script_lang-8a0d3155.js";import{E as b}from"./el-button-15b7c91f.js";import{d as x}from"./Form-3ffbd259.js";import"./tsxHelper-8cb60c66.js";import{E as D}from"./el-input-b7d095a0.js";import{E as w}from"./el-divider-9e019707.js";import{b as k,c as S,a as C,e as R}from"./index-2215acf0.js";import{u as V}from"./useTable-6bd88242.js";import{_ as E}from"./Search.vue_vue_type_script_setup_true_lang-0980fd11.js";import{_ as z}from"./Write.vue_vue_type_script_setup_true_lang-39b697a7.js";import{_ as I}from"./Detail.vue_vue_type_script_setup_true_lang-7b1f0ad9.js";import{_ as N}from"./Dialog.vue_vue_type_style_index_0_lang-fe21049f.js";import{u as T}from"./useCrudSchemas-0c16d738.js";import"./el-card-4e55bb5e.js";import"./el-popper-c9fec1ed.js";import"./constants-0a7e98c8.js";import"./el-tag-ea624222.js";import"./use-form-common-props-9244f2a0.js";import"./el-image-viewer-5fca2747.js";import"./debounce-e9201f72.js";import"./el-dropdown-item-f00169f4.js";import"./refs-0c69b55e.js";import"./use-form-item-9eaef25e.js";import"./el-col-a139f57d.js";import"./el-input-number-88a61b8f.js";import"./InputPassword-844ad265.js";import"./style.css_vue_type_style_index_0_src_true_lang-524c8797.js";import"./aria-ecee1d93.js";import"./index-c4d709dc.js";import"./el-message-box-b134f776.js";import"./el-overlay-32a1ff02.js";import"./vnode-0120c115.js";import"./useForm-40c805c0.js";import"./useIcon-75b77a4a.js";import"./useValidator-eef5f85d.js";import"./Descriptions-3a30bd52.js";import"./tree-b59d36bb.js";const P={class:"flex w-100% h-100%"},U={class:"flex justify-center items-center"},A={class:"flex-1"},L={class:"mb-10px"};function O(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)}const F=a({__name:"User",setup(a){const{t:h}=y(),{tableRegister:F,tableState:B,tableMethods:K}=V({fetchDataApi:async()=>{const{pageSize:e,currentPage:a}=B,l=await k({id:t(te),pageIndex:t(a),pageSize:t(e),...t(Z)});return{list:l.data.list||[],total:l.data.total||0}},fetchDelApi:async()=>!!(await S(t(ce)))}),{total:M,loading:W,dataList:q,pageSize:H,currentPage:J}=B,{getList:$,getElTableExpose:G,delList:Q}=K,X=l([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:h("userDemo.index"),form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:h("userDemo.username")},{field:"account",label:h("userDemo.account")},{field:"department.id",label:h("userDemo.department"),detail:{slots:{default:e=>o(r,null,[e.department.departmentName])}},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:async()=>(await C()).data.list},table:{type:"index"}},{field:"role",label:h("userDemo.role"),search:{hidden:!0}},{field:"email",label:h("userDemo.email"),form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:h("userDemo.createTime"),form:{component:"Input"},search:{hidden:!0}},{field:"action",label:h("userDemo.action"),form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:e=>{let a,t,l;const s=e[0].row;return o(r,null,[o(b,{type:"primary",onClick:()=>ve(s,"edit")},O(a=h("exampleDemo.edit"))?a:{default:()=>[a]}),o(b,{type:"success",onClick:()=>ve(s,"detail")},O(t=h("exampleDemo.detail"))?t:{default:()=>[t]}),o(b,{type:"danger",onClick:()=>fe(s)},O(l=h("exampleDemo.del"))?l:{default:()=>[l]})])}}}}]),{allSchemas:Y}=T(X),Z=s({}),ee=e=>{J.value=1,Z.value=e,$()},ae=s(),te=s(""),le=s([]);(async()=>{var e,a;const l=await C();le.value=l.data.list,te.value=l.data.list[0]&&(null==(e=l.data.list[0])?void 0:e.children)&&l.data.list[0].children[0].id||"",await g(),null==(a=t(ae))||a.setCurrentKey(te.value)})();const oe=s("");i((()=>oe.value),(e=>{t(ae).filter(e)}));const re=e=>{e.children||(te.value=e.id,J.value=1,$())},se=(e,a)=>!e||a.departmentName.includes(e),ie=s(!1),ne=s(""),de=s(),ue=s(""),me=()=>{ne.value=h("exampleDemo.add"),de.value=void 0,ie.value=!0,ue.value=""},pe=s(!1),ce=s([]),fe=async e=>{const a=await G();ce.value=e?[e.id]:(null==a?void 0:a.getSelectionRows().map((e=>e.id)))||[],pe.value=!0,await Q(t(ce).length).finally((()=>{pe.value=!1}))},ve=(e,a)=>{var l;ne.value=h("edit"===a?"exampleDemo.edit":"exampleDemo.detail"),ue.value=a,de.value={...e,department:(null==(l=t(ae))?void 0:l.getCurrentNode())||{}},ie.value=!0},_e=s(),he=s(!1),ye=async()=>{const e=t(_e),a=await(null==e?void 0:e.submit());if(a){he.value=!0;try{await R(a)&&(J.value=1,$())}catch(l){}finally{he.value=!1,ie.value=!1}}};return(a,l)=>(n(),d("div",P,[o(t(e),{class:"flex-1"},{default:u((()=>[m("div",U,[m("div",A,p(t(h)("userDemo.departmentList")),1),o(t(D),{modelValue:oe.value,"onUpdate:modelValue":l[0]||(l[0]=e=>oe.value=e),class:"flex-[2]",placeholder:t(h)("userDemo.searchDepartment"),clearable:""},null,8,["modelValue","placeholder"])]),o(t(w)),o(t(x),{ref_key:"treeEl",ref:ae,data:le.value,"default-expand-all":"","node-key":"id","current-node-key":te.value,props:{label:"departmentName"},"filter-node-method":se,onCurrentChange:re},null,8,["data","current-node-key"])])),_:1}),o(t(e),{class:"flex-[3] ml-20px"},{default:u((()=>[o(t(E),{schema:t(Y).searchSchema,onReset:ee,onSearch:ee},null,8,["schema"]),m("div",L,[o(t(b),{type:"primary",onClick:me},{default:u((()=>[c(p(t(h)("exampleDemo.add")),1)])),_:1}),o(t(b),{loading:pe.value,type:"danger",onClick:l[1]||(l[1]=e=>fe())},{default:u((()=>[c(p(t(h)("exampleDemo.del")),1)])),_:1},8,["loading"])]),o(t(j),{"current-page":t(J),"onUpdate:currentPage":l[2]||(l[2]=e=>f(J)?J.value=e:null),"page-size":t(H),"onUpdate:pageSize":l[3]||(l[3]=e=>f(H)?H.value=e:null),columns:t(Y).tableColumns,data:t(q),loading:t(W),onRegister:t(F),pagination:{total:t(M)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])])),_:1}),o(t(N),{modelValue:ie.value,"onUpdate:modelValue":l[5]||(l[5]=e=>ie.value=e),title:ne.value},{footer:u((()=>["detail"!==ue.value?(n(),v(t(b),{key:0,type:"primary",loading:he.value,onClick:ye},{default:u((()=>[c(p(t(h)("exampleDemo.save")),1)])),_:1},8,["loading"])):_("",!0),o(t(b),{onClick:l[4]||(l[4]=e=>ie.value=!1)},{default:u((()=>[c(p(t(h)("dialogDemo.close")),1)])),_:1})])),default:u((()=>["detail"!==ue.value?(n(),v(z,{key:0,ref_key:"writeRef",ref:_e,"form-schema":t(Y).formSchema,"current-row":de.value},null,8,["form-schema","current-row"])):_("",!0),"detail"===ue.value?(n(),v(I,{key:1,"detail-schema":t(Y).detailSchema,"current-row":de.value},null,8,["detail-schema","current-row"])):_("",!0)])),_:1},8,["modelValue","title"])]))}});export{F as default};
